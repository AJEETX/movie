<!DOCTYPE html>
<html>
    <head>
        <title>
            movies
        </title>
		<link rel="shortcut icon" href="favicon.ico">
    </head>
    <body>
        <h3 id="headline" >please enter username and password as 'webjet'</h3>
        <div>
            
            <form id="movie">
                <div >
                <label for="username">Username</label>
                <input type="text" class="form-control" id="username" placeholder="Username">
                </div>
                <div >
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Password">
                </div>
                <button type="button" onclick="auth()">Authorize</button>
            </form>
			<div id="display-movie" style="display:none" >
				<label for="token">Token</label>
				<div id="token-display">
				</div>
				<br />
				<div id="list">
                </div>
                <div id="click-fn"></div>
                <button type="button" class="btn btn-primary" onclick="getCheapest()">Cheapest</button>
                <button type="button" class="btn btn-primary" onclick="getById(13)">Get Movie ( id=13)</button>
			</div>
        </div>
        <script type="text/javascript">
		var basURL="http://localhost:3000/";
            auth= function(){
                var xhttp = new XMLHttpRequest();
                data={name:document.getElementById("username").value,password:document.getElementById("password").value}
                xhttp.onreadystatechange = function() {
                    if (xhttp.readyState==4 && xhttp.status==200) {                       
						document.getElementById("headline").innerHTML="Movies";
						document.getElementById("movie").style.display="none";
						document.getElementById("display-movie").style.display="block";
                        var response = JSON.parse(xhttp.responseText);
                        document.getElementById("token-display").innerHTML = response.token;
                    }
                    if(xhttp.readyState==4 && xhttp.status==403){
                        document.getElementById("headline").innerHTML=JSON.parse(xhttp.responseText).message;
                    }
                };
                xhttp.open("POST", basURL+"login", true);
                xhttp.setRequestHeader("Content-type", 'application/json; charset=UTF-8');
                xhttp.send(JSON.stringify(data));
            }
            getCheapest= function(){
                console.log("cheapest movie");
                var xhttp = new XMLHttpRequest();
               data={token:document.getElementById("token-display").innerHTML}
               console.log(data);
                xhttp.onreadystatechange = function() {
                    if (xhttp.readyState==4 && xhttp.status==200) {
                        document.getElementById("list").style.display="block";
						document.getElementById("list").innerHTML=xhttp.responseText;	
                    }
                    if(xhttp.readyState==4 && xhttp.status==403){
                      document.getElementById("list").innerHTML=JSON.parse(xhttp.responseText).message;
                    }
                };
                xhttp.open("POST", basURL+"movie", true);
                xhttp.setRequestHeader("Content-type", 'application/json; charset=UTF-8');
                xhttp.send(JSON.stringify(data));
            }
			getById= function(id){
                console.log(" movie by id");
                var xhttp = new XMLHttpRequest();
               data={token:document.getElementById("token-display").innerHTML}
               console.log(data);
                xhttp.onreadystatechange = function() {
                    if (xhttp.readyState==4 && xhttp.status==200) {
                        document.getElementById("list").style.display="block";
						document.getElementById("list").innerHTML=xhttp.responseText;	
                    }
                    if(xhttp.readyState==4 && xhttp.status==403){
                      document.getElementById("list").innerHTML=JSON.parse(xhttp.responseText).message;
                    }
                };
                xhttp.open("POST", basURL+"movie/"+id, true);
                xhttp.setRequestHeader("Content-type", 'application/json; charset=UTF-8');
                xhttp.send(JSON.stringify(data));
            }
        </script>
    </body>
</html>